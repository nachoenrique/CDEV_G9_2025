xx<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Giroscopio - iPhone 16</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .info-label {
            font-weight: 600;
            opacity: 0.8;
        }

        .info-value {
            font-weight: 700;
            text-align: right;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-ok { background: #4ade80; }
        .status-error { background: #f87171; }
        .status-warning { background: #fbbf24; }

        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4ade80 0%, #3b82f6 100%);
            color: white;
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .values-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }

        .value-bar {
            margin-bottom: 15px;
        }

        .value-label {
            font-size: 12px;
            margin-bottom: 5px;
            opacity: 0.9;
        }

        .bar-container {
            background: rgba(255, 255, 255, 0.1);
            height: 30px;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }

        .bar-fill {
            position: absolute;
            height: 100%;
            background: linear-gradient(90deg, #4ade80 0%, #3b82f6 100%);
            transition: all 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }

        .log {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            line-height: 1.4;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 3px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .visualizer {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            position: relative;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ball {
            width: 40px;
            height: 40px;
            background: radial-gradient(circle at 30% 30%, #4ade80, #3b82f6);
            border-radius: 50%;
            position: absolute;
            transition: all 0.1s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test de Giroscopio</h1>
        
        <!-- Informaci√≥n del dispositivo -->
        <div class="info-card">
            <h3 style="margin-bottom: 15px;">üì± Informaci√≥n del Dispositivo</h3>
            <div class="info-row">
                <span class="info-label">User Agent:</span>
                <span class="info-value" id="user-agent">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">Es iOS:</span>
                <span class="info-value" id="is-ios">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">Es M√≥vil:</span>
                <span class="info-value" id="is-mobile">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">Touch Points:</span>
                <span class="info-value" id="touch-points">-</span>
            </div>
        </div>

        <!-- Estado del giroscopio -->
        <div class="info-card">
            <h3 style="margin-bottom: 15px;">üéÆ Estado del Giroscopio</h3>
            <div class="info-row">
                <span class="info-label">API Disponible:</span>
                <span class="info-value" id="api-available">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">Requiere Permiso:</span>
                <span class="info-value" id="requires-permission">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">Permiso:</span>
                <span class="info-value" id="permission-status">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">Eventos Recibidos:</span>
                <span class="info-value" id="events-count">0</span>
            </div>
            <div class="info-row">
                <span class="info-label">Protocolo:</span>
                <span class="info-value" id="protocol">-</span>
            </div>
        </div>

        <!-- Botones de control -->
        <button class="btn btn-primary" id="request-permission-btn">
            üîì Solicitar Permiso y Activar
        </button>
        <button class="btn btn-secondary" id="stop-btn" disabled>
            ‚èπÔ∏è Detener
        </button>

        <!-- Visualizador -->
        <div class="visualizer">
            <div class="ball" id="ball"></div>
        </div>

        <!-- Valores en tiempo real -->
        <div class="info-card">
            <h3 style="margin-bottom: 15px;">üìä Valores en Tiempo Real</h3>
            <div class="values-display">
                <div class="value-bar">
                    <div class="value-label">Beta (Adelante/Atr√°s): <span id="beta-value">0</span>¬∞</div>
                    <div class="bar-container">
                        <div class="bar-fill" id="beta-bar"></div>
                    </div>
                </div>
                <div class="value-bar">
                    <div class="value-label">Gamma (Izquierda/Derecha): <span id="gamma-value">0</span>¬∞</div>
                    <div class="bar-container">
                        <div class="bar-fill" id="gamma-bar"></div>
                    </div>
                </div>
                <div class="value-bar">
                    <div class="value-label">Alpha (Rotaci√≥n): <span id="alpha-value">0</span>¬∞</div>
                    <div class="bar-container">
                        <div class="bar-fill" id="alpha-bar"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Log de eventos -->
        <div class="info-card">
            <h3 style="margin-bottom: 15px;">üìù Log de Eventos</h3>
            <div class="log" id="log"></div>
        </div>
    </div>

    <script>
        // Variables globales
        let eventsCount = 0;
        let isListening = false;
        let orientationHandler = null;

        // Elementos del DOM
        const userAgentEl = document.getElementById('user-agent');
        const isIOSEl = document.getElementById('is-ios');
        const isMobileEl = document.getElementById('is-mobile');
        const touchPointsEl = document.getElementById('touch-points');
        const apiAvailableEl = document.getElementById('api-available');
        const requiresPermissionEl = document.getElementById('requires-permission');
        const permissionStatusEl = document.getElementById('permission-status');
        const eventsCountEl = document.getElementById('events-count');
        const protocolEl = document.getElementById('protocol');
        const betaValueEl = document.getElementById('beta-value');
        const gammaValueEl = document.getElementById('gamma-value');
        const alphaValueEl = document.getElementById('alpha-value');
        const betaBarEl = document.getElementById('beta-bar');
        const gammaBarEl = document.getElementById('gamma-bar');
        const alphaBarEl = document.getElementById('alpha-bar');
        const logEl = document.getElementById('log');
        const ballEl = document.getElementById('ball');
        const requestBtn = document.getElementById('request-permission-btn');
        const stopBtn = document.getElementById('stop-btn');

        // Funciones de utilidad
        function addLog(message) {
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            logEl.insertBefore(entry, logEl.firstChild);
            
            // Limitar a 50 entradas
            while (logEl.children.length > 50) {
                logEl.removeChild(logEl.lastChild);
            }
        }

        function getStatusIndicator(status) {
            const color = status ? 'ok' : 'error';
            return `<span class="status-indicator status-${color}"></span>${status ? '‚úÖ S√≠' : '‚ùå No'}`;
        }

        function updateBar(barEl, valueEl, value, min, max) {
            const percentage = ((value - min) / (max - min)) * 100;
            barEl.style.width = `${percentage}%`;
            barEl.textContent = `${value.toFixed(1)}¬∞`;
            valueEl.textContent = value.toFixed(1);
        }

        function updateBallPosition(beta, gamma) {
            // Normalizar valores
            const x = (gamma / 90) * 80; // -80 a 80 px
            const y = (beta / 90) * 80;  // -80 a 80 px
            
            ballEl.style.transform = `translate(${x}px, ${y}px)`;
        }

        // Detectar dispositivo
        function detectDevice() {
            const ua = navigator.userAgent;
            userAgentEl.textContent = ua.substring(0, 30) + '...';
            userAgentEl.title = ua;

            const isIOSDevice = /iPad|iPhone|iPod/.test(ua) || 
                               (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
            const isMobileDevice = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(ua);

            isIOSEl.innerHTML = getStatusIndicator(isIOSDevice);
            isMobileEl.innerHTML = getStatusIndicator(isMobileDevice);
            touchPointsEl.textContent = navigator.maxTouchPoints || 0;

            addLog(`Dispositivo detectado: ${isIOSDevice ? 'iOS' : 'Otro'}`);
            return isIOSDevice;
        }

        // Verificar API
        function checkAPI() {
            const available = 'DeviceOrientationEvent' in window;
            const requiresPermission = typeof DeviceOrientationEvent !== 'undefined' && 
                                      typeof DeviceOrientationEvent.requestPermission === 'function';
            
            apiAvailableEl.innerHTML = getStatusIndicator(available);
            requiresPermissionEl.innerHTML = getStatusIndicator(requiresPermission);
            protocolEl.textContent = window.location.protocol;

            if (available) {
                addLog('‚úÖ DeviceOrientationEvent API disponible');
            } else {
                addLog('‚ùå DeviceOrientationEvent API NO disponible');
            }

            if (requiresPermission) {
                addLog('‚ö†Ô∏è Se requiere permiso expl√≠cito (iOS 13+)');
            }

            if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost') {
                addLog('‚ö†Ô∏è ADVERTENCIA: No est√°s en HTTPS. El giroscopio puede no funcionar.');
            }

            return { available, requiresPermission };
        }

        // Iniciar escucha
        function startListening() {
            if (isListening) return;

            orientationHandler = (event) => {
                eventsCount++;
                eventsCountEl.textContent = eventsCount;

                const alpha = event.alpha || 0;
                const beta = event.beta || 0;
                const gamma = event.gamma || 0;

                // Actualizar barras
                updateBar(betaBarEl, betaValueEl, beta, -180, 180);
                updateBar(gammaBarEl, gammaValueEl, gamma, -90, 90);
                updateBar(alphaBarEl, alphaValueEl, alpha, 0, 360);

                // Actualizar visualizador
                updateBallPosition(beta, gamma);

                // Log solo el primer evento
                if (eventsCount === 1) {
                    addLog(`‚úÖ Primer evento recibido: Œ≤=${beta.toFixed(1)}¬∞ Œ≥=${gamma.toFixed(1)}¬∞`);
                } else if (eventsCount % 100 === 0) {
                    addLog(`üìä ${eventsCount} eventos procesados`);
                }
            };

            window.addEventListener('deviceorientation', orientationHandler, true);
            isListening = true;
            addLog('üëÇ Listener de deviceorientation iniciado');
        }

        // Detener escucha
        function stopListening() {
            if (!isListening) return;

            window.removeEventListener('deviceorientation', orientationHandler, true);
            isListening = false;
            addLog('‚èπÔ∏è Listener detenido');
            
            requestBtn.disabled = false;
            stopBtn.disabled = true;
        }

        // Solicitar permiso
        async function requestPermission() {
            addLog('üîê Solicitando permiso...');
            
            try {
                if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                    const permission = await DeviceOrientationEvent.requestPermission();
                    permissionStatusEl.innerHTML = `<span class="status-indicator status-${permission === 'granted' ? 'ok' : 'error'}"></span>${permission}`;
                    
                    if (permission === 'granted') {
                        addLog('‚úÖ Permiso OTORGADO');
                        startListening();
                        requestBtn.disabled = true;
                        stopBtn.disabled = false;
                    } else {
                        addLog(`‚ùå Permiso DENEGADO: ${permission}`);
                        alert('‚ö†Ô∏è Debes permitir el acceso a los sensores de movimiento para usar el giroscopio.');
                    }
                } else {
                    // No requiere permiso
                    permissionStatusEl.innerHTML = getStatusIndicator(true);
                    addLog('‚úÖ No se requiere permiso (autom√°tico)');
                    startListening();
                    requestBtn.disabled = true;
                    stopBtn.disabled = false;
                }
            } catch (error) {
                addLog(`‚ùå Error al solicitar permiso: ${error.message}`);
                permissionStatusEl.innerHTML = `<span class="status-indicator status-error"></span>Error`;
                
                if (error.toString().includes('secure context')) {
                    alert('‚ö†Ô∏è El giroscopio solo funciona en HTTPS. Por favor, accede mediante HTTPS.');
                } else {
                    alert(`‚ö†Ô∏è Error: ${error.message}`);
                }
            }
        }

        // Event listeners
        requestBtn.addEventListener('click', requestPermission);
        stopBtn.addEventListener('click', stopListening);

        // Inicializaci√≥n
        window.addEventListener('DOMContentLoaded', () => {
            addLog('üöÄ Aplicaci√≥n iniciada');
            detectDevice();
            checkAPI();
        });
    </script>
</body>
</html>
